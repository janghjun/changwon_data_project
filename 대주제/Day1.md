# Day1 필요 데이터셋 정리

 1. 중주제 때 이미 확보·정제된 데이터 (재사용 가능)

* **교통 (B5)**

  * `/first_data/derived/B5_qol_transit_final.csv`
    → 정류장 접근성, 노선 다양성, 평균 headway (정시성 CV는 보조)

    * 대주제 Day1에서는 여기서 **stop\_density, headway\_mean, headway\_cv**를 그대로 활용 가능.
    * 다만 대주제에서는 **500m 접근성(stop\_density\_500m)** 지표 추가 산출 필요.

* **인구**

  * `/first_data/derived/POP_TOTAL_MONTHLY_adm9.csv`
  * `/first_data/derived/POP_YOUTH20_39_ANNUAL_adm9.csv`
    → 청년 기준이 중주제 당시 20–34세였는데, 대주제에서는 **20–39세로 확정 변경**됨.

    * 이미 20–39세 버전을 정제한 파일이 있으므로, 이를 주 데이터로 사용.

* **주거 (임대료)**

  * `/first_data/derived/cost_emdm_panel_v4_2_winsor.csv`
    → m²당 임대료, 윈저라이즈, log 변환본

    * 대주제에서는 이 값을 그대로 쓰되, \*\*기간을 2020–2023 → 최근 10년(2015\~)\*\*으로 확장 필요.

* **청년 순유입률 (Y)**

  * `/first_data/derived/YOUTH_NET_RATE_EMD_MONTHLY_from_GU_ANNUAL.csv`
    → 구×연 단위를 EMD×월로 downscale한 버전

    * 중주제 한계: 2020–2023까지만, 연→월 상수화라 변동성 낮음
    * 대주제에서는 **KOSIS 월 전입·전출 데이터 확보 → 월 패널 보강** 필요.

* **산업/고용 (B6)**

  * `/first_data/derived/B6_adm9_full.csv`
    → 취업밀도, 산업 구조, 면적 보정 통제변수

---

## 2. 대주제에서 새로 추가/수집해야 하는 데이터

* **건축 인허가 데이터 (공급 예측용)** --> **완료**

  * 현재 first\_data에는 없음 → 신규 수집 필요
  * 후보 출처:

    * KOSIS → 건축 인허가 현황 (시군구, 용도별/세대수별)
    * 국토부 건축 인허가 통계/오픈API
  * 저장 경로(예정):

    * `/first_data/master_sec/permit/building_permits_monthly.parquet`

* **청년 인구 이동 (전입·전출, 수요 추정용)**

  * 중주제는 구×연 수준만 확보했음
  * 대주제에서는 **20–39세 전입·전출(월 단위, 구→EMD 분배)** 데이터가 필요.
  * 신규 수집: KOSIS 주민등록 인구이동통계 (연령·성별·시군구 단위)

* **장기 인구 패널 (10년치)**

  * 중주제: 2020–2023 4년만 활용
  * 대주제: 최근 10년치(예: 2015–2024)를 확보해야 함

* **RIR(주거비 부담률) 계산용 소득 데이터**

  * 중주제에서는 평균 소득 대신 단순 비율만 사용
  * 대주제에서는 **청년 소득 추정치(분위/중위) 보강** 필요 → KOSIS 가계동향조사, 통계청 소득분포 자료

* **현행/계획 공공주택·LH 공고 좌표화 데이터**

  * 비교·검증용: 공공임대 공급 예정지, 시/LH 계획 자료
  * 별도 크롤링/공문 확보 필요

---

# 대주제 진행 시 수정·보완 포인트 (중주제 대비 변경 사항)

1. **청년 인구 정의**

   * 중주제: 20–34세 사용
   * 대주제: 20–39세로 확정
   * → `pop_emd_youth20_39.csv`를 표준으로 사용, 기존 20–34 자료는 폐기.

2. **기간 확장**

   * 중주제: 2020–2023 (결측 때문에 2024 제외)
   * 대주제: 최근 10년치(2015\~2024) 사용
   * → 인구, 임대료, 교통 모두 과거 연장 데이터 확보 필요.

3. **RIR 계산식**

   * 중주제: `RIR = monthly_rent_equiv / youth_income` 단순 산출
   * 대주제: 월세환산(전세→월세) 반영 + 청년 소득 분위/중위값 기반 계수 적용
   * → 청년 소득 자료 수집 및 RIR 재계산 필요.

4. **교통 지표**

   * 중주제: 정시성 CV는 데이터 품질 문제로 제외/민감도용
   * 대주제: 정시성 CV, stop\_density\_500m, transit\_score까지 본선 반영
   * → 기존 B5에서 확장 필요.

5. **Gap 산출**

   * 중주제: 공급 측면 고려 X
   * 대주제: 건축 인허가 → 준공 라그 적용해 12/18개월 공급 예측
   * → 인허가 데이터 신규 수집 및 준공 캘린더 생성 필요.

## 인허가 라그 처리 방식

### 데이터 원본
```
확보한 자료는 permit_supply_monthly.csv (구×월×APT/NONAPT 공급량).

여기서 “준공예정월” 기준으로 공급 시점을 정의했습니다.
→ 인허가(permit) → 착공 → 준공 → 실제 입주까지 시간이 걸리므로,
실제 공급 효과는 ‘준공예정월’ 기준으로 잡은 거예요.
```
### 라그 적용 로직
```
기준월(BASE_MONTH, 예: 2024-12)을 정합니다.

공급은 이 기준월 이후로,

12개월 이내 (기준월+12)

18개월 이내 (기준월+18)
두 구간으로 합산했습니다.

 즉, 인허가 시점에서 바로 공급으로 잡지 않고,
준공 예정일(라그 반영된 값) 만을 이용해서 12M/18M “입주 공급”을 계산한 겁니다.
```
```
mask_12 = (sup["준공예정월"] > base_month_ts) & (sup["준공예정월"] <= base_month_ts + pd.DateOffset(months=12))
mask_18 = (sup["준공예정월"] > base_month_ts) & (sup["준공예정월"] <= base_month_ts + pd.DateOffset(months=18))
```
### APT / NONAPT 구분
```
건물명·용도코드 등을 기준으로 APT 그룹(아파트/오피스텔 등) vs NONAPT 그룹(단독·다가구 등) 을 나눠 공급량을 집계했습니다.

보고서에서는 주로 APT 공급량 중심으로 보되, 필요시 NONAPT도 병행 비교할 수 있도록 구조를 남겨놨습니다.
```
### 최종 Gap 산출
```
수요 측(청년 20–39 인구 증가분)을 연평균 추세로 12M/18M 환산.

공급 측(인허가 → 준공 라그 적용)과 비교해서 gap_12m, gap_18m 산출.
```
### 정리
```
인허가 데이터 → 준공예정월 기준 라그 반영

12M / 18M 구간 집계로 공급량 계산

APT/NONAPT 구분 포함
```
최종적으로 수요–공급 Gap을 구별 단위로 산출
---

# 최종 정리

## Day1 진행 시 사용할 기존 데이터셋 (first\_data 기준)

* `/derived/B5_qol_transit_final.csv` (교통 접근성/정시성)
* `/derived/POP_TOTAL_MONTHLY_adm9.csv`, `/derived/POP_YOUTH20_39_ANNUAL_adm9.csv` (인구)
* `/derived/cost_emdm_panel_v4_2_winsor.csv` (임대료)
* `/derived/YOUTH_NET_RATE_EMD_MONTHLY_from_GU_ANNUAL.csv` (순유입률, 보완 필요)
* `/derived/B6_adm9_full.csv` (산업/고용 통제)

## Day1에서 새로 수집·보완해야 할 데이터

* `/master_sec/permit/building_permits_monthly.parquet` (인허가 → 준공 라그)
* `/master_sec/pop/youth_migration_monthly.parquet` (20–39세 전입/전출, KOSIS 기반)
* `/master_sec/pop/youth_income_distribution.csv` (청년 소득 추정, RIR 재계산용)
* `/master_sec/housing/public_housing_plan.csv` (LH·시 공급 계획, 좌표화)

---

## Day1 데이터셋 설명 및 설계 근거

### 1. 정적 지표 (master_emd_static_day1.csv)
 컬럼명	설명	구성 이유	결측 가능성/원인
 adm9	행정동 단위 코드 (7자리 or 9자리 축약)	모든 데이터 병합의 키 값	없음
 adm_cd10	10자리 법정동 코드	GeoJSON 및 KOSIS 등 외부자료와 호환	없음
 adm_nm	행정동 한글명 (예: "창원시 의창구 동읍")	해석/시각화를 위한 이름	없음
 stop_density_500m	행정동 경계 내 500m 버퍼 반경에서 집계한 정류장 밀도	청년 주거 선호에 중요한 교통 접근성 지표	결측 없음 (모든 행정동 경계에 최소 1개 이상 정류장 매핑됨)
 qol_transit_z, qol_transit_0_100	교통 접근성 종합지수 (표준화 점수, 0–100 점수)	기존 B5 QoL 지표. stop_density 보완용	없음
 emp_per_km2	고용 밀도 (고용자 수 / km²)	산업·고용 기반 접근성 반영	일부 농촌 지역(동읍/북면 등)에서 값=0 (산업체 없음)
 factories_per_km2	사업체 수 밀도	고용환경 파악용 보조 지표	위와 동일
 area_km2	행정동 면적	밀도 계산 시 기준	없음
### 2. 월 패널 지표 (master_emd_monthly_day1.csv)
 컬럼명	설명	구성 이유	결측 가능성/원인
 adm9	행정동 코드	병합 키	없음
 yyyymm	연월 (예: 202412)	패널 시계열 분석 기준	일부 시점에서 결측 (예: KOSIS 원천에 없는 월)
 pop_total	총인구	기본 수요 변수	일부 월 결측 (행정기관 집계 미반영 시)
 youth20_39_persons	청년(20–39세) 인구	분석 타깃 변수	일부 행정동은 소규모라 데이터 마스킹(공개 불가 → NaN)
 rent_mean, rent_p50	㎡당 임대료 (평균/중위값)	주거비 부담 지표	거래 없는 달은 결측 발생
 n_obs	임대료 관측 수	임대료 신뢰도 검증용	적은 관측치 → 신뢰도 저하
 reliability	임대료 품질 태그 ("ok", "low")	리포트에서 해석 가이드 제공	없음

## 설계 근거

### 교통(정적)

 Day1은 "거주환경의 구조적 요인"을 다루므로, 고정된 인프라(정류장 밀도, 고용 밀도, 면적 등)는 정적 지표로 구성.
 
 stop_density_500m은 실제 생활권 반영을 위해 추가 산출.

### 인구/임대료(동태적)

 매월 변화하는 수요(인구)와 가격(임대료)은 월 패널로 구성.
 
 이를 통해 시간 추세 및 shock 분석(예: 2020–2024 코로나 시기)을 가능하게 함.

## 청년층 초점

 총인구가 아닌 20–39세 코호트를 별도 구성 → 청년 주거/이동성과 직결.

## 결측치 발생 이유 정리

### 청년 인구 (youth20_39_persons)

 KOSIS·통계청 마이크로데이터는 소규모 동 단위에서 개인정보 보호를 위해 값이 비공개 처리됨 → NaN.

### 임대료 (rent_mean, rent_p50)

 일부 행정동은 월별 거래량이 없어(특히 농촌/산업단지 지역) 해당 월 임대료 값이 결측.

### 고용 (emp_per_km2)

 일부 주거지역(의창동, 팔룡동 등)은 사업체가 거의 없거나 통계상 0으로 집계됨. → 결측 아님, 실제 값=0.

## 결론:
 현재 Day1 데이터셋은 정적(고정 인프라) + **동적(월 패널)**로 균형 있게 구성되었고, 결측치는 통계 비공개·거래 부재·실제 0값에 기인합니다.
→ EDA/리포트에서는 결측/0값을 그대로 표시하면서, 보조지표(n_obs, reliability)로 해석의 신뢰도를 보강하면 됩니다.

시각화 방향

1. 결측치 표시 방식
	•	단순히 빈칸으로 두지 말고 라벨링/시각적 마킹:
	•	예: 임대료 없음 → 회색 점/막대,
	•	인구 비공개 → 점선 테두리/빈 공간 처리
	•	그래프 캡션/범례에 “비공개 처리”, “거래 없음” 등 이유를 명시.

⸻

2. 각 데이터셋별 추천 시각화
	1.	교통 접근성 (B5) vs 임대료
	•	산점도 (scatter plot)
	•	X축: stop_density_500m or qol_transit_z
	•	Y축: rent_mean
	•	결측치 지역은 회색 점 + 라벨링 (거래 없음).
	2.	청년 인구 추세
	•	라인차트 (line plot)
	•	X축: 연도
	•	Y축: youth20_39_persons
	•	결측 동은 점선 라인 + 보조 텍스트 “비공개 처리”.
	3.	고용 기반
	•	히트맵 or 막대그래프
	•	emp_per_km2 값이 0인 곳은 흰색/빈칸으로 표시 → 실제 0임을 강조.
	•	결측값(만약 있다면)은 회색 톤으로 별도 구분.
	4.	통합 EDA (멀티패널)
	•	패널 구조 (3x1): 인구 / 임대료 / 교통 점수
	•	같은 adm9 단위를 공유해서 비교하기 쉽게.

⸻

3. 보고서용 시각화 규칙 반영
	•	폰트: NanumBarunGothic
	•	축·범례: 10–11pt / 제목: 14–16pt
	•	컬러 팔레트:
	•	Gap/ECR: 녹–노–적 (Green–Yellow–Red)
	•	색각 보정 버전: Blue–Yellow–Red
	•	Y축 단위 통일 (호/가구/점수)
	•	라벨:
	•	+ → 부족(수요>공급)
	•	– → 여유
	•	숫자는 콤마 + 단위 (예: +1,200호)

⸻

4. 추가 아이디어
	•	결측치가 많은 변수(예: 임대료)는 **지도 시각화(choropleth)**와 같이 “비어있는 동”을 시각적으로 보여주면 더 명확.
	•	신뢰도(reliability)에 따라 점 크기/투명도 조절 → 데이터 해석에 신뢰 구간 느낌 추가.

---

## 라그 계산 (2024.12)
	* 인허가월 = 준공월 − 라그
	* APT 라그 = 30개월, Non-APT 라그 = 12개월
| 구분 | 라그 | 완공창 | 인허가 | 기간(=완공창 시작/끝에서 라그만큼 당김) |
| APT | 30M | 12M: 2025-01 ~ 2025-12 | 2022-07 ~ 2023-12 |
| APT | 30M | 18M: 2025-01 ~ 2026-06 | 2022-07 ~ 2024-12 |
| Non-APT | 12M | 12M: 2025-01 ~ 2025-12 | 2024-01 ~ 2024-12 |
| Non-APT | 12M | 18M: 2025-01 ~ 2026-06 | 2024-01 ~ 2025-06 |

	1.	apt_group에 따라 라그를 적용해 expected_completion = 허가월 + (30/12)개월 계산
	2.	완공창 필터
	•	12M: 2025-01 ≤ expected_completion ≤ 2025-12
	•	18M: 2025-01 ≤ expected_completion ≤ 2026-06
	3.	그 결과를 월 단위로 합산해 supply_12m, supply_18m 재계산(필요시 APT/NONAPT 브레이크다운 유지)
